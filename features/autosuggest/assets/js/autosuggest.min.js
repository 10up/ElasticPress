!function(u){"use strict";if(epas.endpointUrl&&""!==epas.endpointUrl){var e=u('.ep-autosuggest, input[type="search"], .search-field'),n=u('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');e.each(function(e,t){var s=u('<div class="ep-autosuggest-container"></div>'),o=u(t);o.attr("autocomplete","off"),s.insertAfter(o);var a=o.siblings("label");o.closest("form").find(".ep-autosuggest-container").append(a).append(o),n.clone().insertAfter(o),o.trigger("elasticpress.input.moved")}),n.css({top:e.outerHeight()-1,"background-color":e.css("background-color")}),u(e).each(function(e,t){u(t).on("keyup keydown keypress",function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),27===e.keyCode&&p()})}),e.each(function(e,t){var s,o,a,r=u(t);r.on("keyup",(s=function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode&&27!==e.keyCode){var t=r.val(),s=epas.postType,o=epas.postStatus,a=epas.searchFields;2<=t.length?l(i(t,s,o,a)).done(function(e){if(0<e._shards.successful){var n={},i=[];u.each(e.hits.hits,function(e,t){var s=t._source.post_title,o=t._source.permalink,a=t._source.post_id;n[a]||(n[a]=!0,i.push({text:s,url:o}))}),0===i.length?p():c(i,r)}else p()}):0===t.length&&p()}},o=200,a=null,function(){var e=this,t=arguments;window.clearTimeout(a),a=window.setTimeout(function(){s.apply(e,t)},o)}))}),window.epasAPI={hideAutosuggestBox:p,updateAutosuggestBox:c,esSearch:l,buildSearchQuery:i}}function r(e,t){if("navigate"===epas.action)return s=t.dataset.url,window.location.href=s;var s,o,a;o=e,a=t.innerText,o.val(a),e.closest("form").submit()}function i(e,t,s,o){"all"!==t&&void 0!==t&&""!==t||(t="all"),""===s&&(s="publish");var a={sort:[{_score:{order:"desc"}}],query:{multi_match:{query:e,fields:o}}};return"string"==typeof t&&"all"!==t&&(t=t.split(",")),"string"==typeof s&&(s=s.split(",")),a.post_filter={bool:{must:[{terms:{post_status:s}}]}},"all"!==t&&a.post_filter.bool.must.push({terms:{"post_type.raw":t}}),a}function l(e){return jQuery.support.cors=!0,u.ajax({url:epas.endpointUrl,type:"post",dataType:"json",contentType:"application/json; charset=utf-8",crossDomain:!0,data:JSON.stringify(e)})}function c(e,a){var t,s=a.closest(".ep-autosuggest-container").find(".ep-autosuggest"),o=s.find(".autosuggest-list");for(o.empty(),u(".autosuggest-item").off(),0<e.length?s.show():s.hide(),t=0;t<e.length;++t){var n=e[t].text,i=e[t].url;u('<li><span class="autosuggest-item" data-search="'+n+'" data-url="'+i+'">'+n+"</span></li>").appendTo(o)}u(".autosuggest-item").on("click",function(e){r(a,e.target)}),a.off("keydown"),a.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode||13===e.keyCode){var t,s=a.closest(".ep-autosuggest-container").find(".autosuggest-list li"),o=s.filter(".selected");switch(e.keyCode){case 38:t=o.prev();break;case 40:t=s.hasClass("selected")?o.next():(s.first().addClass("selected"),s.first());break;case 13:return s.hasClass("selected")?(r(a,o.children("span").get(0)),!1):void 0}return t.is("li")?(o.removeClass("selected"),t.addClass("selected")):s.removeClass("selected"),38!==e.keyCode&&void 0}})}function p(){u(".autosuggest-list").empty(),u(".ep-autosuggest").hide()}}(jQuery);