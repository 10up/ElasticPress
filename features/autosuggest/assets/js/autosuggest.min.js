!function(e){"use strict";function t(e){e.closest("form").submit()}function s(e,t){e.val(t)}function o(e,t){return window.location.href=t}function a(e,a){if("navigate"===epas.action)return o(e,a.dataset.url);s(e,a.innerText),t(e)}function n(e,t){var s=null;return function(){var o=this,a=arguments;window.clearTimeout(s),s=window.setTimeout(function(){e.apply(o,a)},t)}}function i(e,t,s,o){"all"!==t&&void 0!==t&&""!==t||(t="all"),""===s&&(t="publish");var a={sort:[{_score:{order:"desc"}}],query:{multi_match:{query:e,fields:o}}};return"string"==typeof t&&"all"!==t&&(t=t.split(",")),"string"==typeof s&&(s=s.split(",")),a.post_filter={bool:{must:[{terms:{post_status:s}}]}},"all"!==t&&a.post_filter.bool.must.push({terms:{"post_type.raw":t}}),a}function u(t){return jQuery.support.cors=!0,e.ajax({url:epas.endpointUrl,type:"post",dataType:"json",crossDomain:!0,data:JSON.stringify(t)})}function r(t,s){var o,n=s.closest(".ep-autosuggest-container").find(".ep-autosuggest"),i=n.find(".autosuggest-list");for(i.empty(),e(".autosuggest-item").off(),t.length>0?n.show():n.hide(),o=0;o<t.length;++o){var u=t[o].text,r=t[o].url;e('<li><span class="autosuggest-item" data-search="'+u+'" data-url="'+r+'">'+u+"</span></li>").appendTo(i)}e(".autosuggest-item").on("click",function(e){a(s,e.srcElement)}),s.off("keydown"),s.on("keydown",function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode);else{var t,o=s.closest(".ep-autosuggest-container").find(".autosuggest-list li"),n=o.filter(".selected");switch(e.keyCode){case 38:t=n.prev();break;case 40:o.hasClass("selected")?t=n.next():(o.first().addClass("selected"),t=o.first());break;case 13:return o.hasClass("selected")?(a(s,n.children("span").get(0)),!1):void 0}if(t.is("li")?(n.removeClass("selected"),t.addClass("selected")):o.removeClass("selected"),38===e.keyCode)return!1}})}function l(){e(".autosuggest-list").empty(),e(".ep-autosuggest").hide()}if(epas.endpointUrl&&""!==epas.endpointUrl){var c=e('.ep-autosuggest, input[type="search"], .search-field'),d=e('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');c.each(function(t,s){var o=e('<div class="ep-autosuggest-container"></div>'),a=e(s);a.attr("autocomplete","off"),o.insertAfter(a);var n=a.siblings("label");a.closest("form").find(".ep-autosuggest-container").append(n).append(a),d.clone().insertAfter(a),a.trigger("elasticpress.input.moved")}),d.css({top:c.outerHeight()-1,"background-color":c.css("background-color")}),e(c).each(function(t,s){e(s).on("keyup keydown keypress",function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),27===e.keyCode&&l()})}),c.each(function(t,s){var o=e(s);o.on("keyup",n(function(t){if(38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode&&27!==t.keyCode){var s=o.val(),a=epas.postType,n=epas.postStatus,c=epas.searchFields;s.length>=2?u(i(s,a,n,c)).done(function(t){if(t._shards.successful>0){var s={},a=[];e.each(t.hits.hits,function(e,t){var o=t._source.post_title,n=t._source.permalink,i=t._source.post_id;s[i]||(s[i]=!0,a.push({text:o,url:n}))}),0===a.length?l():r(a,o)}else l()}):0===s.length&&l()}},200))}),window.epasAPI={hideAutosuggestBox:l,updateAutosuggestBox:r,esSearch:u,buildSearchQuery:i}}}(jQuery);