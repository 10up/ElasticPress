!function(r){"use strict";if(epas.endpointUrl&&""!==epas.endpointUrl){var e=r('.ep-autosuggest, input[type="search"], .search-field'),n=r('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');r(".autosuggest-item");e.each(function(e,t){var s=r('<div class="ep-autosuggest-container"></div>'),o=r(t);o.attr("autocomplete","off"),s.insertAfter(o);var a=o.siblings("label");o.closest("form").find(".ep-autosuggest-container").append(a).append(o),n.clone().insertAfter(o),o.trigger("elasticpress.input.moved")}),n.css({top:e.outerHeight()-1,"background-color":e.css("background-color")}),r(e).each(function(e,t){r(t).on("keyup keydown keypress",function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),27===e.keyCode&&p()})}),e.each(function(e,t){var s,o,a,u=r(t);u.on("keyup",(s=function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode&&27!==e.keyCode){var t=u.val(),s=epas.postType,o=epas.postStatus,a=epas.searchFields;2<=t.length?l(i(t,s,o,a)).done(function(e){if(0<e._shards.successful){var n={},i=[];r.each(e.hits.hits,function(e,t){var s=t._source.post_title,o=t._source.permalink,a=t._source.post_id;n[a]||(n[a]=!0,i.push({text:s,url:o}))}),0===i.length?p():c(i,u)}else p()}):0===t.length&&p()}},o=200,a=null,function(){var e=this,t=arguments;window.clearTimeout(a),a=window.setTimeout(function(){s.apply(e,t)},o)}))}),window.epasAPI={hideAutosuggestBox:p,updateAutosuggestBox:c,esSearch:l,buildSearchQuery:i}}function u(e,t){if("navigate"===epas.action)return function(e,t){var s="click - "+e[0].value;if("function"!=typeof gtag)return window.location.href=t;gtag("event",s,{event_category:"EP :: Autosuggest",event_label:t,transport_type:"beacon",event_callback:function(){window.location.href=t}})}(e,t.dataset.url);var s,o;s=e,o=t.innerText,s.val(o),e.closest("form").submit()}function i(e,t,s,o){"all"!==t&&void 0!==t&&""!==t||(t="all"),""===s&&(t="publish");var a={sort:[{_score:{order:"desc"}}],query:{multi_match:{query:e,fields:o}}};return"string"==typeof t&&"all"!==t&&(t=t.split(",")),"string"==typeof s&&(s=s.split(",")),a.post_filter={bool:{must:[{terms:{post_status:s}}]}},"all"!==t&&a.post_filter.bool.must.push({terms:{"post_type.raw":t}}),a}function l(e){return jQuery.support.cors=!0,r.ajax({url:epas.endpointUrl,type:"post",dataType:"json",contentType:"application/json; charset=utf-8",crossDomain:!0,data:JSON.stringify(e)})}function c(e,a){var t,s=a.closest(".ep-autosuggest-container").find(".ep-autosuggest"),o=s.find(".autosuggest-list");for(o.empty(),r(".autosuggest-item").off(),0<e.length?s.show():s.hide(),t=0;t<e.length;++t){var n=e[t].text,i=e[t].url;r('<li><span class="autosuggest-item" data-search="'+n+'" data-url="'+i+'">'+n+"</span></li>").appendTo(o)}r(".autosuggest-item").on("click",function(e){u(a,e.target)}),a.off("keydown"),a.on("keydown",function(e){if(38===e.keyCode||40===e.keyCode||13===e.keyCode){var t,s=a.closest(".ep-autosuggest-container").find(".autosuggest-list li"),o=s.filter(".selected");switch(e.keyCode){case 38:t=o.prev();break;case 40:t=s.hasClass("selected")?o.next():(s.first().addClass("selected"),s.first());break;case 13:return s.hasClass("selected")?(u(a,o.children("span").get(0)),!1):void 0}return t.is("li")?(o.removeClass("selected"),t.addClass("selected")):s.removeClass("selected"),38!==e.keyCode&&void 0}})}function p(){r(".autosuggest-list").empty(),r(".ep-autosuggest").hide()}}(jQuery);