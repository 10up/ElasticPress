!function(a){function b(){if(0===q)i.css({width:"1%"});else{var a=parseInt(q)/parseInt(r)*100;i.css({width:a+"%"})}if("sync"===o){var b=ep.sync_syncing+" "+parseInt(q)+"/"+parseInt(r);e&&(b+=" ("+e.url+")"),j.text(b),j.show(),i.show(),m.show(),h.addClass("syncing"),n.hide(),l.hide(),k.hide()}else if("pause"===o){var b=ep.sync_paused+" "+parseInt(q)+"/"+parseInt(r);e&&(b+=" ("+e.url+")"),j.text(b),j.show(),i.show(),m.hide(),h.addClass("syncing"),n.show(),l.show(),k.hide()}else if("wpcli"===o){var b=ep.sync_wpcli;j.text(b),j.show(),i.hide(),m.hide(),h.addClass("syncing"),n.hide(),l.hide(),k.hide()}else if("error"===o){if(j.text(ep.sync_error),j.show(),k.show(),n.hide(),l.hide(),m.hide(),h.removeClass("syncing"),i.hide(),p){var c=g.find(".ep-feature-"+p);c.removeClass("feature-syncing")}p=null,setTimeout(function(){j.hide()},7e3)}else if("cancel"===o){if(j.hide(),i.hide(),m.hide(),h.removeClass("syncing"),n.hide(),l.hide(),k.show(),p){var c=g.find(".ep-feature-"+p);c.removeClass("feature-syncing")}p=null}else if("finished"===o){if(j.text(ep.sync_complete),j.show(),i.hide(),m.hide(),n.hide(),l.hide(),k.show(),h.removeClass("syncing"),p){var c=g.find(".ep-feature-"+p);c.removeClass("feature-syncing")}p=null,setTimeout(function(){j.hide()},7e3)}}function c(){a.ajax({method:"post",url:ajaxurl,data:{action:"ep_cancel_index",nonce:ep.nonce}})}function d(){a.ajax({method:"post",url:ajaxurl,data:{action:"ep_index",feature_sync:p,nonce:ep.nonce}}).done(function(a){return"sync"===o?(r=a.data.found_posts,q=a.data.offset,a.data.site_stack&&(f=a.data.site_stack),a.data.current_site&&(e=a.data.current_site),f&&f.length?(o="sync",b(),void d()):void(0!==a.data.found_posts||a.data.start?(o="sync",b(),d()):(o="finished",b()))):void 0}).error(function(a){a&&a.status&&parseInt(a.status)>=400&&parseInt(a.status)<600&&(o="error",b(),c())})}var e,f,g=a(document.getElementsByClassName("ep-features")),h=a(document.getElementsByClassName("error-overlay")),i=a(document.getElementsByClassName("progress-bar")),j=a(document.getElementsByClassName("sync-status")),k=a(document.getElementsByClassName("start-sync")),l=a(document.getElementsByClassName("resume-sync")),m=a(document.getElementsByClassName("pause-sync")),n=a(document.getElementsByClassName("cancel-sync")),o="sync",p=!1,q=0,r=0;g.on("click",".learn-more, .collapse",function(b){$feature=a(this).parents(".ep-feature"),$feature.toggleClass("show-full")}),g.on("click",".settings-button",function(b){$feature=a(this).parents(".ep-feature"),$feature.toggleClass("show-settings")}),g.on("click",".save-settings",function(b){b.preventDefault();var c=b.target.getAttribute("data-feature"),e=g.find(".ep-feature-"+c),f={},h=e.find(".setting-field");h.each(function(){var b=a(this).attr("type"),c=a(this).attr("data-field-name"),d=a(this).attr("value");"radio"===b&&a(this).attr("checked")&&(f[c]=d)}),e.addClass("saving"),a.ajax({method:"post",url:ajaxurl,data:{action:"ep_save_feature",feature:c,nonce:ep.nonce,settings:f}}).done(function(a){setTimeout(function(){e.removeClass("saving"),"1"===f.active?e.addClass("feature-active"):e.removeClass("feature-active"),a.data.reindex&&(o="sync",e.addClass("feature-syncing"),p=c,d())},700)}).error(function(){setTimeout(function(){e.removeClass("saving"),e.removeClass("feature-active"),e.removeClass("feature-syncing")},700)})}),ep.index_meta?ep.index_meta.wpcli?(o="wpcli",b()):(q=ep.index_meta.offset,r=ep.index_meta.found_posts,ep.index_meta.feature_sync&&(p=ep.index_meta.feature_sync),ep.index_meta.current_site&&(e=ep.index_meta.current_site),ep.index_meta.site_stack&&(f=ep.index_meta.site_stack),f&&f.length?ep.auto_start_index?(o="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),b(),d()):(o="pause",b()):0!==r||ep.index_meta.start?ep.auto_start_index?(o="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),b(),d()):(o="pause",b()):(o="finished",b())):ep.auto_start_index&&(o="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),b(),d()),k.on("click",function(){o="sync",d()}),m.on("click",function(){o="pause",b()}),l.on("click",function(){o="sync",b(),d()}),n.on("click",function(){o="cancel",b(),c()})}(jQuery);