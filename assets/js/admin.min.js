!function(a){function b(){if(0===q)i.css({width:"1%"});else{var a=parseInt(q)/parseInt(r)*100;i.css({width:a+"%"})}if("sync"===o){var b="Syncing "+parseInt(q)+"/"+parseInt(r);e&&(b+=" ("+e.url+")"),j.text(b),j.show(),i.show(),m.show(),h.addClass("syncing"),n.hide(),l.hide(),k.hide()}else if("pause"===o){var b="Syncing paused "+parseInt(q)+"/"+parseInt(r);e&&(b+=" ("+e.url+")"),j.text(b),j.show(),i.show(),m.hide(),h.addClass("syncing"),n.show(),l.show(),k.hide()}else if("wpcli"===o){var b="WP CLI sync is occuring. Refresh the page to see if it's finished";j.text(b),j.show(),i.hide(),m.hide(),h.addClass("syncing"),n.hide(),l.hide(),k.hide()}else if("error"===o){if(j.text("An error occured while syncing"),j.show(),k.show(),n.hide(),l.hide(),m.hide(),h.removeClass("syncing"),i.hide(),p){var c=g.find(".ep-module-"+p);c.removeClass("module-syncing")}p=null,setTimeout(function(){j.hide()},7e3)}else if("cancel"===o){if(j.hide(),i.hide(),m.hide(),h.removeClass("syncing"),n.hide(),l.hide(),k.show(),p){var c=g.find(".ep-module-"+p);c.removeClass("module-syncing")}p=null}else if("finished"===o||"noposts"===o){if("noposts"===o?j.text("No posts to sync"):j.text("Sync complete"),i.hide(),m.hide(),n.hide(),l.hide(),k.show(),h.removeClass("syncing"),p){var c=g.find(".ep-module-"+p);c.removeClass("module-syncing")}p=null,setTimeout(function(){j.hide()},7e3)}}function c(){a.ajax({method:"post",url:ajaxurl,data:{action:"ep_cancel_index",nonce:ep.nonce}})}function d(){a.ajax({method:"post",url:ajaxurl,data:{action:"ep_index",module_sync:p,nonce:ep.nonce}}).done(function(a){"sync"===o&&(r=a.data.found_posts,q=a.data.offset,a.data.site_stack&&(f=a.data.site_stack),a.data.current_site&&(e=a.data.current_site),0===a.data.found_posts?a.data.start?(o="noposts",b()):(o="finished",b()):(o="sync",b(),d()))}).error(function(){o="error",b(),c()})}var e,f,g=a(document.getElementsByClassName("ep-modules")),h=a(".error-overlay"),i=a(".progress-bar"),j=a(".sync-status"),k=a(".start-sync"),l=a(".resume-sync"),m=a(".pause-sync"),n=a(".cancel-sync"),o="sync",p=!1,q=0,r=0;g.on("click",".learn-more, .collapse",function(b){$module=a(this).parents(".ep-module"),$module.toggleClass("show-all")}),g.on("click",".js-toggle-module",function(b){b.preventDefault();var c=b.target.getAttribute("data-module"),e=a(this);e.addClass("processing");var f=g.find(".ep-module-"+c);a.ajax({method:"post",url:ajaxurl,data:{action:"ep_toggle_module",module:c,nonce:ep.nonce}}).done(function(a){setTimeout(function(){e.removeClass("processing"),f.toggleClass("module-active"),a.data.active&&a.data.reindex&&(o="sync",f.addClass("module-syncing"),p=c,d())},700)}).error(function(){setTimeout(function(){e.removeClass("processing"),f.removeClass("module-active"),f.removeClass("module-syncing")},700)})}),ep.index_meta&&(ep.index_meta.wpcli?(o="wpcli",b()):(q=ep.index_meta.offset,r=ep.index_meta.found_posts,ep.index_meta.module_sync&&(p=ep.index_meta.module_sync),ep.index_meta.current_site&&(e=ep.index_meta.current_site),ep.index_meta.site_stack&&(f=ep.index_meta.site_stack),0===r?response.data.start?(o="noposts",b()):(o="finished",b()):ep.auto_start_index?(o="sync",d()):(o="pause",b()))),k.on("click",function(){o="sync",d()}),m.on("click",function(){o="pause",b()}),l.on("click",function(){o="sync",d()}),n.on("click",function(){o="cancel",b(),c()})}(jQuery);