!function(n){var s,t,i=n(document.getElementsByClassName("ep-features")),a=n(document.getElementsByClassName("error-overlay")),c=n(document.getElementsByClassName("progress-bar")),o=n(document.getElementsByClassName("sync-status")),d=n(document.getElementsByClassName("start-sync")),r=n(document.getElementsByClassName("resume-sync")),u=n(document.getElementsByClassName("pause-sync")),l=n(document.getElementsByClassName("cancel-sync")),h="sync",p=!1,f=0,m=0;function y(){if(0===f)c.css({width:"1%"});else{var e=parseInt(f)/parseInt(m)*100;c.css({width:e+"%"})}if("initialsync"===h){var t=epDash.sync_initial;o.text(t),o.show(),c.show(),u.show(),a.addClass("syncing"),l.hide(),r.hide(),d.hide()}else if("sync"===h){t=epDash.sync_syncing+" "+parseInt(f)+"/"+parseInt(m);s&&(t+=" ("+s.url+")"),o.text(t),o.show(),c.show(),u.show(),a.addClass("syncing"),l.hide(),r.hide(),d.hide()}else if("pause"===h){t=epDash.sync_paused;m&&0!==m&&(t+=" "+parseInt(f)+"/"+parseInt(m)),s&&(t+=" ("+s.url+")"),o.text(t),o.show(),c.show(),u.hide(),a.addClass("syncing"),l.show(),r.show(),d.hide()}else if("wpcli"===h){t=epDash.sync_wpcli;o.text(t),o.show(),c.hide(),u.hide(),a.addClass("syncing"),l.hide(),r.hide(),d.hide()}else if("error"===h){if(o.text(epDash.sync_error),o.show(),d.show(),l.hide(),r.hide(),u.hide(),a.removeClass("syncing"),c.hide(),p)i.find(".ep-feature-"+p).removeClass("feature-syncing");p=null,setTimeout(function(){o.hide()},7e3)}else if("cancel"===h){if(o.hide(),c.hide(),u.hide(),a.removeClass("syncing"),l.hide(),r.hide(),d.show(),p)i.find(".ep-feature-"+p).removeClass("feature-syncing");p=null}else if("finished"===h){if(o.text(epDash.sync_complete),o.show(),c.hide(),u.hide(),l.hide(),r.hide(),d.show(),a.removeClass("syncing"),p)i.find(".ep-feature-"+p).removeClass("feature-syncing");p=null,setTimeout(function(){o.hide()},7e3)}}function _(){n.ajax({method:"post",url:ajaxurl,data:{action:"ep_cancel_index",nonce:epDash.nonce}})}function g(){n.ajax({method:"post",url:ajaxurl,data:{action:"ep_index",feature_sync:p,nonce:epDash.nonce}}).done(function(e){if("sync"===h){if(m=e.data.found_posts,f=e.data.offset,e.data.site_stack&&(t=e.data.site_stack),e.data.current_site&&(s=e.data.current_site),t&&t.length)return h="sync",y(),void g();0!==e.data.found_posts||e.data.start?(h="sync",y(),g()):(h="finished",y())}}).error(function(e){e&&e.status&&400<=parseInt(e.status)&&parseInt(e.status)<600&&(h="error",y(),_())})}i.on("click",".learn-more, .collapse",function(e){$feature=n(this).parents(".ep-feature"),$feature.toggleClass("show-full")}),i.on("click",".settings-button",function(e){$feature=n(this).parents(".ep-feature"),$feature.toggleClass("show-settings")}),i.on("click",".save-settings",function(e){if(e.preventDefault(),!n(this).hasClass("disabled")){var t=e.target.getAttribute("data-feature"),s=i.find(".ep-feature-"+t),a={};s.find(".setting-field").each(function(){var e=n(this).attr("type"),t=n(this).attr("data-field-name"),s=n(this).attr("value");"radio"===e?n(this).attr("checked")&&(a[t]=s):a[t]=s}),s.addClass("saving"),n.ajax({method:"post",url:ajaxurl,data:{action:"ep_save_feature",feature:t,nonce:epDash.nonce,settings:a}}).done(function(e){setTimeout(function(){s.removeClass("saving"),"1"===a.active?s.addClass("feature-active"):s.removeClass("feature-active"),e.data.reindex&&(h="initialsync",y(),n('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),h="sync",s.addClass("feature-syncing"),p=t,g())},700)}).error(function(){setTimeout(function(){s.removeClass("saving"),s.removeClass("feature-active"),s.removeClass("feature-syncing")},700)})}}),epDash.index_meta?epDash.index_meta.wpcli_sync?(h="wpcli",y()):(f=epDash.index_meta.offset,m=epDash.index_meta.found_posts,epDash.index_meta.feature_sync&&(p=epDash.index_meta.feature_sync),epDash.index_meta.current_site&&(s=epDash.index_meta.current_site),epDash.index_meta.site_stack&&(t=epDash.index_meta.site_stack),t&&t.length?epDash.auto_start_index?(h="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),y(),g()):(h="pause",y()):0!==m||epDash.index_meta.start?epDash.auto_start_index?(h="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),y(),g()):(h="pause",y()):(h="finished",y())):epDash.auto_start_index&&(h="initialsync",y(),h="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),g()),d.on("click",function(){h="initialsync",y(),n('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),h="sync",g()}),u.on("click",function(){h="pause",y()}),r.on("click",function(){h="sync",y(),g()}),l.on("click",function(){h="cancel",y(),_()})}(jQuery);