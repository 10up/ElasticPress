!function(e){function t(){if(0===y)d.css({width:"1%"});else{var e=parseInt(y)/parseInt(_)*100;d.css({width:e+"%"})}if("initialsync"===f){t=epDash.sync_initial;r.text(t),r.show(),d.show(),h.show(),o.addClass("syncing"),p.hide(),l.hide(),u.hide()}else if("sync"===f){t=epDash.sync_syncing+" "+parseInt(y)+"/"+parseInt(_);n&&(t+=" ("+n.url+")"),r.text(t),r.show(),d.show(),h.show(),o.addClass("syncing"),p.hide(),l.hide(),u.hide()}else if("pause"===f){t=epDash.sync_paused;_&&0!==_&&(t+=" "+parseInt(y)+"/"+parseInt(_)),n&&(t+=" ("+n.url+")"),r.text(t),r.show(),d.show(),h.hide(),o.addClass("syncing"),p.show(),l.show(),u.hide()}else if("wpcli"===f){var t=epDash.sync_wpcli;r.text(t),r.show(),d.hide(),h.hide(),o.addClass("syncing"),p.hide(),l.hide(),u.hide()}else if("error"===f)r.text(epDash.sync_error),r.show(),u.show(),p.hide(),l.hide(),h.hide(),o.removeClass("syncing"),d.hide(),m&&(s=c.find(".ep-feature-"+m)).removeClass("feature-syncing"),m=null,setTimeout(function(){r.hide()},7e3);else if("cancel"===f)r.hide(),d.hide(),h.hide(),o.removeClass("syncing"),p.hide(),l.hide(),u.show(),m&&(s=c.find(".ep-feature-"+m)).removeClass("feature-syncing"),m=null;else if("finished"===f){if(r.text(epDash.sync_complete),r.show(),d.hide(),h.hide(),p.hide(),l.hide(),u.show(),o.removeClass("syncing"),m){var s=c.find(".ep-feature-"+m);s.removeClass("feature-syncing")}m=null,setTimeout(function(){r.hide()},7e3)}}function s(){e.ajax({method:"post",url:ajaxurl,data:{action:"ep_cancel_index",nonce:epDash.nonce}})}function a(){e.ajax({method:"post",url:ajaxurl,data:{action:"ep_index",feature_sync:m,nonce:epDash.nonce}}).done(function(e){if("sync"===f){if(_=e.data.found_posts,y=e.data.offset,e.data.site_stack&&(i=e.data.site_stack),e.data.current_site&&(n=e.data.current_site),i&&i.length)return f="sync",t(),void a();0!==e.data.found_posts||e.data.start?(f="sync",t(),a()):(f="finished",t())}}).error(function(e){e&&e.status&&parseInt(e.status)>=400&&parseInt(e.status)<600&&(f="error",t(),s())})}var n,i,c=e(document.getElementsByClassName("ep-features")),o=e(document.getElementsByClassName("error-overlay")),d=e(document.getElementsByClassName("progress-bar")),r=e(document.getElementsByClassName("sync-status")),u=e(document.getElementsByClassName("start-sync")),l=e(document.getElementsByClassName("resume-sync")),h=e(document.getElementsByClassName("pause-sync")),p=e(document.getElementsByClassName("cancel-sync")),f="sync",m=!1,y=0,_=0;c.on("click",".learn-more, .collapse",function(t){$feature=e(this).parents(".ep-feature"),$feature.toggleClass("show-full")}),c.on("click",".settings-button",function(t){$feature=e(this).parents(".ep-feature"),$feature.toggleClass("show-settings")}),c.on("click",".save-settings",function(s){if(s.preventDefault(),!e(this).hasClass("disabled")){var n=s.target.getAttribute("data-feature"),i=c.find(".ep-feature-"+n),o={};i.find(".setting-field").each(function(){var t=e(this).attr("type"),s=e(this).attr("data-field-name"),a=e(this).attr("value");"radio"===t?e(this).attr("checked")&&(o[s]=a):o[s]=a}),i.addClass("saving"),e.ajax({method:"post",url:ajaxurl,data:{action:"ep_save_feature",feature:n,nonce:epDash.nonce,settings:o}}).done(function(s){setTimeout(function(){i.removeClass("saving"),"1"===o.active?i.addClass("feature-active"):i.removeClass("feature-active"),s.data.reindex&&(f="initialsync",t(),e('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),f="sync",i.addClass("feature-syncing"),m=n,a())},700)}).error(function(){setTimeout(function(){i.removeClass("saving"),i.removeClass("feature-active"),i.removeClass("feature-syncing")},700)})}}),epDash.index_meta?epDash.index_meta.wpcli_sync?(f="wpcli",t()):(y=epDash.index_meta.offset,_=epDash.index_meta.found_posts,epDash.index_meta.feature_sync&&(m=epDash.index_meta.feature_sync),epDash.index_meta.current_site&&(n=epDash.index_meta.current_site),epDash.index_meta.site_stack&&(i=epDash.index_meta.site_stack),i&&i.length?epDash.auto_start_index?(f="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),t(),a()):(f="pause",t()):0!==_||epDash.index_meta.start?epDash.auto_start_index?(f="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),t(),a()):(f="pause",t()):(f="finished",t())):epDash.auto_start_index&&(f="initialsync",t(),f="sync",history.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),a()),u.on("click",function(){f="initialsync",t(),e('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),f="sync",a()}),h.on("click",function(){f="pause",t()}),l.on("click",function(){f="sync",t(),a()}),p.on("click",function(){f="cancel",t(),s()})}(jQuery);