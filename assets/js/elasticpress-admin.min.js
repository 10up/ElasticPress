jQuery(document).ready(function(a){var b=!1,c=0,d=0,e=0,f=0,g=a("#ep_run_index"),h=a("#ep_pause_index"),i=a("#ep_restart_index"),j=a("#ep_keep_active"),k=function(c,d,e,f,g){if(!b){a(d).val(ep.running_index_text).removeClass("button-primary").attr("disabled",!0),a(g).attr("disabled",!0),a(e).removeClass("hidden"),a(f).addClass("hidden");var h=a("#progressbar"),i=a("#progressstats");if(h.show(),c){var j=0;parseInt(ep.total_posts)>0&&(j=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts),i.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed_suff)),h.progressbar({value:100*j})}o(h,d,e,f,i,g)}},l=function(c,d,e,f){var g=a(c),h=g.data("paused");if("enabled"===h)g.val(ep.index_pause_text).data("paused","disabled"),b=!1,k(!1,d,c,e,f);else{var i={action:"ep_pause_index",keep_active:f.is(":checked"),nonce:ep.pause_nonce};a.ajax({url:ajaxurl,type:"POST",data:i,complete:function(c){g.val(ep.index_resume_text).data("paused","enabled"),a(d).val(ep.index_paused_text).attr("disabled",!0),a(e).removeClass("hidden"),b=!0}})}},m=function(c,d,e,f){var g={action:"ep_restart_index",nonce:ep.restart_nonce};a.ajax({url:ajaxurl,type:"POST",data:g,complete:function(g){n(),a(c).addClass("hidden"),a(d).val(ep.index_pause_text).data("paused","disabled").addClass("hidden"),a(e).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(f).attr("disabled",!1),a("#progressstats").text(""),a("#progressbar").fadeOut("slow"),b=!1}})},n=function(){c=0,d=0,e=0},o=function(b,g,h,i,j,l){var m={action:"ep_launch_index",keep_active:l.is(":checked"),nonce:ep.nonce};a.ajax({url:ajaxurl,type:"POST",data:m,complete:function(m){if("undefined"==typeof m.responseJSON||"undefined"==typeof m.responseJSON.data)a("#progressstats").text(ep.failed_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(l).attr("disabled",!1),a(h).addClass("hidden"),a(i).addClass("hidden"),a("#progressbar").fadeOut("slow");else{var o="";0===m.responseJSON.data.is_network?(d=m.responseJSON.data.ep_posts_total,e=m.responseJSON.data.ep_posts_synced):(c!==m.responseJSON.data.ep_sites_remaining&&(c=m.responseJSON.data.ep_sites_remaining,d+=m.responseJSON.data.ep_posts_total,f++),o=f+ep.sites,e+=m.responseJSON.data.ep_current_synced);var p=parseFloat(e)/parseFloat(d);b.progressbar({value:100*p}),j.text(e+"/"+d+" "+ep.items_indexed+o),1==m.responseJSON.data.ep_sync_complete?(b.progressbar({value:100}),setTimeout(function(){a("#progressbar").fadeOut("slow"),a("#progressstats").html(ep.complete_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(l).attr("disabled",!1),a(h).addClass("hidden"),a(i).addClass("hidden"),a("#ep_activate").prop("checked",!0),n()},1e3)):k(!1,g,h,i,l)}}})},p=function(){var b=a("#progressbar"),c=a("#progressstats");b.show();var d=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts);b.progressbar({value:100*d}),c.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed)};1==ep.index_running&&1!=ep.paused&&k(!0,g,h,i,j),1==ep.index_running&&1==ep.paused&&p(),g.click(function(b){b.preventDefault(),n();var c=this;a(c).hasClass("button-primary")&&(a("#progressstats").text(ep.running_index_text),k(!0,c,h,i,j))}),h.click(function(a){a.preventDefault(),l(this,g,i,j)}),i.click(function(a){a.preventDefault(),m(this,h,g,j)});var q=a("#ep_site_select");q.change(function(b){b.preventDefault();var c={action:"ep_get_site_stats",nonce:ep.stats_nonce,site:q.val()};a.ajax({url:ajaxurl,type:"POST",data:c,complete:function(b){a("#ep_site_stats").html(b.responseJSON.data)}})})});