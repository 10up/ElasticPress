jQuery(document).ready(function(a){var b=!1,c=0,d=0,e=0,f=0,g=a("#ep_run_index"),h=a("#ep_pause_index"),i=function(c,d,e){if(!b){a(d).val(ep.running_index_text).removeClass("button-primary").attr("disabled",!0),a(e).removeClass("hidden");var f=a("#progressbar"),g=a("#progressstats");if(f.show(),c){var h=0;parseInt(ep.total_posts)>0&&(h=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts),g.text(ep.synced_posts+"/"+ep.total_posts+" items")),f.progressbar({value:100*h})}l(f,d,e,g)}},j=function(c,d){var e=a(c),f=e.data("paused");if("enabled"===f)e.val(ep.index_pause_text).data("paused","disabled"),b=!1,i(!1,d,c);else{var g={action:"ep_pause_index",nonce:ep.pause_nonce};a.ajax({url:ajaxurl,type:"POST",data:g,complete:function(c){e.val(ep.index_resume_text).data("paused","enabled"),a(d).val(ep.index_paused_text).attr("disabled",!0),b=!0}})}},k=function(){c=0,d=0,e=0},l=function(b,g,h,j){var l={action:"ep_launch_index",nonce:ep.nonce};a.ajax({url:ajaxurl,type:"POST",data:l,complete:function(l){if("undefined"==typeof l.responseJSON||"undefined"==typeof l.responseJSON.data)a("#progressstats").text(ep.failed_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(h).addClass("hidden"),a("#progressbar").fadeOut("slow");else{var m="";0===l.responseJSON.data.is_network?(d=l.responseJSON.data.ep_posts_total,e=l.responseJSON.data.ep_posts_synced):(c!==l.responseJSON.data.ep_sites_remaining&&(c=l.responseJSON.data.ep_sites_remaining,d+=l.responseJSON.data.ep_posts_total,f++),m=f+ep.sites,e+=l.responseJSON.data.ep_current_synced);var n=parseFloat(e)/parseFloat(d);b.progressbar({value:100*n}),j.text(e+"/"+d+" "+ep.items_indexed+m),1==l.responseJSON.data.ep_sync_complete?(b.progressbar({value:100}),setTimeout(function(){a("#progressbar").fadeOut("slow"),a("#progressstats").html(ep.complete_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(h).addClass("hidden"),k()},1e3)):i(!1,g,h)}}})},m=function(){var b=a("#progressbar"),c=a("#progressstats");b.show();var d=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts);b.progressbar({value:100*d}),c.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed)};1==ep.index_running&&1!=ep.paused&&i(!0,g,h),1==ep.index_running&&1==ep.paused&&m(),g.click(function(b){b.preventDefault(),k();var c=this;a(c).hasClass("button-primary")&&(a("#progressstats").text(ep.running_index_text),i(!0,c,h))}),h.click(function(a){a.preventDefault(),j(this,g)});var n=a("#ep_site_select");n.change(function(b){b.preventDefault();var c={action:"ep_get_site_stats",nonce:ep.stats_nonce,site:n.val()};a.ajax({url:ajaxurl,type:"POST",data:c,complete:function(b){a("#ep_site_stats").html(b.responseJSON.data)}})})});