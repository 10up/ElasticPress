jQuery(document).ready(function(a){var b=!1,c=0,d=0,e=0,f=0,g=a("#ep_run_index"),h=a("#ep_pause_index"),i=a("#ep_restart_index"),j=function(c,d,e,f){if(!b){a(d).val(ep.running_index_text).removeClass("button-primary").attr("disabled",!0),a(e).removeClass("hidden"),a(f).addClass("hidden");var g=a("#progressbar"),h=a("#progressstats");if(g.show(),c){var i=0;parseInt(ep.total_posts)>0&&(i=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts),h.text(ep.synced_posts+"/"+ep.total_posts+" items")),g.progressbar({value:100*i})}n(g,d,e,f,h)}},k=function(c,d,e){var f=a(c),g=f.data("paused");if("enabled"===g)f.val(ep.index_pause_text).data("paused","disabled"),b=!1,j(!1,d,c,e);else{var h={action:"ep_pause_index",nonce:ep.pause_nonce};a.ajax({url:ajaxurl,type:"POST",data:h,complete:function(c){f.val(ep.index_resume_text).data("paused","enabled"),a(d).val(ep.index_paused_text).attr("disabled",!0),a(e).removeClass("hidden"),b=!0}})}},l=function(c,d,e){var f={action:"ep_restart_index",nonce:ep.restart_nonce};a.ajax({url:ajaxurl,type:"POST",data:f,complete:function(f){m(),a(c).addClass("hidden"),a(d).val(ep.index_pause_text).data("paused","disabled").addClass("hidden"),a(e).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a("#progressstats").text(""),a("#progressbar").fadeOut("slow"),b=!1}})},m=function(){c=0,d=0,e=0},n=function(b,g,h,i,k){var l={action:"ep_launch_index",nonce:ep.nonce};a.ajax({url:ajaxurl,type:"POST",data:l,complete:function(l){if("undefined"==typeof l.responseJSON||"undefined"==typeof l.responseJSON.data)a("#progressstats").text(ep.failed_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(h).addClass("hidden"),a(i).addClass("hidden"),a("#progressbar").fadeOut("slow");else{var n="";0===l.responseJSON.data.is_network?(d=l.responseJSON.data.ep_posts_total,e=l.responseJSON.data.ep_posts_synced):(c!==l.responseJSON.data.ep_sites_remaining&&(c=l.responseJSON.data.ep_sites_remaining,d+=l.responseJSON.data.ep_posts_total,f++),n=f+ep.sites,e+=l.responseJSON.data.ep_current_synced);var o=parseFloat(e)/parseFloat(d);b.progressbar({value:100*o}),k.text(e+"/"+d+" "+ep.items_indexed+n),1==l.responseJSON.data.ep_sync_complete?(b.progressbar({value:100}),setTimeout(function(){a("#progressbar").fadeOut("slow"),a("#progressstats").html(ep.complete_text),a(g).val(ep.index_complete_text).addClass("button-primary").attr("disabled",!1),a(h).addClass("hidden"),a(i).addClass("hidden"),m()},1e3)):j(!1,g,h,i)}}})},o=function(){var b=a("#progressbar"),c=a("#progressstats");b.show();var d=parseFloat(ep.synced_posts)/parseFloat(ep.total_posts);b.progressbar({value:100*d}),c.text(ep.synced_posts+"/"+ep.total_posts+" "+ep.items_indexed)};1==ep.index_running&&1!=ep.paused&&j(!0,g,h,i),1==ep.index_running&&1==ep.paused&&o(),g.click(function(b){b.preventDefault(),m();var c=this;a(c).hasClass("button-primary")&&(a("#progressstats").text(ep.running_index_text),j(!0,c,h,i))}),h.click(function(a){a.preventDefault(),k(this,g,i)}),i.click(function(a){a.preventDefault(),l(this,h,g)});var p=a("#ep_site_select");p.change(function(b){b.preventDefault();var c={action:"ep_get_site_stats",nonce:ep.stats_nonce,site:p.val()};a.ajax({url:ajaxurl,type:"POST",data:c,complete:function(b){a("#ep_site_stats").html(b.responseJSON.data)}})})});