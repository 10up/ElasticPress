!function(){var e,t,n=window,a=n.ajaxurl,s=n.epDash,i=n.history,c=jQuery(document.getElementsByClassName("ep-features")),o=jQuery(document.getElementsByClassName("error-overlay")),r=jQuery(document.getElementsByClassName("progress-bar")),l=jQuery(document.getElementsByClassName("sync-status")),d=jQuery(document.getElementsByClassName("start-sync")),u=jQuery(document.getElementsByClassName("resume-sync")),y=jQuery(document.getElementsByClassName("pause-sync")),m=jQuery(document.getElementsByClassName("cancel-sync")),h=jQuery(document.getElementsByClassName("ep-credentials-tab")),f=jQuery(".ep-host-row label"),p=jQuery(document.getElementsByClassName("ep-host-legend")),_=jQuery(document.getElementsByClassName("ep-additional-fields")),v=document.getElementById("ep_host"),g=v?v.value:null,x="",C="sync",w=!1,j=0,Q=0;function b(){var t;if(0===j)r.css({width:"1%"});else{var n=parseInt(j,10)/parseInt(Q,10)*100;r.css({width:"".concat(n,"%")})}if("initialsync"===C)t=s.sync_initial,l.text(t),l.show(),r.show(),y.show(),o.addClass("syncing"),m.hide(),u.hide(),d.hide();else if("sync"===C)t=s.sync_syncing,e&&(e.indexable&&(t+=" ".concat(s.sync_indexable_labels[e.indexable].plural.toLowerCase()," ").concat(parseInt(j,10),"/").concat(parseInt(Q,10))),e.url&&(t+=" (".concat(e.url,")"))),l.text(t),l.show(),r.show(),y.show(),o.addClass("syncing"),m.hide(),u.hide(),d.hide();else if("pause"===C)t=s.sync_paused,Q&&0!==Q&&(t+=", ".concat(parseInt(j,10),"/").concat(parseInt(Q,10)," ").concat(s.sync_indexable_labels[e.indexable].plural.toLowerCase())),e&&e.url&&(t+=" (".concat(e.url,")")),l.text(t),l.show(),r.show(),y.hide(),o.addClass("syncing"),m.show(),u.show(),d.hide();else if("wpcli"===C){var a,i;t=s.sync_wpcli,null!==(a=e)&&void 0!==a&&a.indexable&&(t+=" ".concat(parseInt(j,10),"/").concat(parseInt(Q,10)," ").concat(s.sync_indexable_labels[e.indexable].plural.toLowerCase())),null!==(i=e)&&void 0!==i&&i.url&&(t+=" (".concat(e.url,")")),l.text(t),l.show(),r.show(),y.hide(),o.addClass("syncing"),m.show(),u.hide(),d.hide()}else"error"===C?(l.text(s.sync_error),l.show(),d.show(),m.hide(),u.hide(),y.hide(),o.removeClass("syncing"),r.hide(),w&&c.find(".ep-feature-".concat(w)).removeClass("feature-syncing"),w=null,setTimeout((function(){l.hide()}),7e3)):"cancel"===C?(l.hide(),r.hide(),y.hide(),o.removeClass("syncing"),m.hide(),u.hide(),d.show(),w&&c.find(".ep-feature-".concat(w)).removeClass("feature-syncing"),w=null):"finished"===C?(l.text(s.sync_complete),l.show(),r.hide(),y.hide(),m.hide(),u.hide(),d.show(),o.removeClass("syncing"),w&&c.find(".ep-feature-".concat(w)).removeClass("feature-syncing"),w=null,setTimeout((function(){l.hide()}),7e3)):"interrupt"===C&&(l.text(s.sync_interrupted),l.show(),r.hide(),y.hide(),m.hide(),u.hide(),d.show(),o.removeClass("syncing"),w&&c.find(".ep-feature-".concat(w)).removeClass("feature-syncing"),w=null,setTimeout((function(){l.hide()}),7e3))}function E(){jQuery.ajax({method:"post",url:a,data:{action:"ep_cancel_index",nonce:s.nonce}})}function k(){jQuery.ajax({method:"post",url:a,data:{action:"ep_cli_index",feature_sync:w,nonce:s.nonce}}).done((function(t){if("wpcli"===C){var n,a,s,i,c;if(Q=null===(n=t.data)||void 0===n?void 0:n.total_items,j=null===(a=t.data)||void 0===a?void 0:a.items_indexed,e={indexable:null===(s=t.data)||void 0===s?void 0:s.slug,url:null===(i=t.data)||void 0===i?void 0:i.url},null!==(c=t.data)&&void 0!==c&&c.indexing)return b(),void k();C="",b()}else if("interrupt"===C)return;C="finished",b()}))}function B(){jQuery.ajax({method:"post",url:a,data:{action:"ep_index",feature_sync:w,nonce:s.nonce}}).done((function(n){var a,i;if(null!==(a=n.data)&&void 0!==a&&a.should_interrupt_sync&&(C="interrupt",b(),E()),"cli"===(null===(i=n.data)||void 0===i?void 0:i.method))return C="wpcli",void k();if("sync"===C){if(Q=n.data.found_items,j=n.data.offset,n.data.sync_stack&&(t=n.data.sync_stack),n.data.current_sync_item&&(e=n.data.current_sync_item),t&&t.length)return C="sync",b(),void B();0!==n.data.found_items||n.data.start?(C="sync",b(),B()):(C="finished",b(),s.install_sync&&document.location.replace(s.install_complete_url))}})).error((function(e){e&&e.status&&parseInt(e.status,10)>=400&&parseInt(e.status,10)<600&&(C="error",b(),E())}))}c.on("click",".learn-more, .collapse",(function(){jQuery(this).parents(".ep-feature").toggleClass("show-full")})),c.on("click",".settings-button",(function(){jQuery(this).parents(".ep-feature").toggleClass("show-settings")})),c.on("click",".save-settings",(function(e){if(e.preventDefault(),!jQuery(this).hasClass("disabled")){var t=e.target.getAttribute("data-feature"),n=c.find(".ep-feature-".concat(t)),i={};n.find(".setting-field").each((function(){var e=jQuery(this),t=e.attr("type"),n=e.attr("data-field-name"),a=e.val();"radio"===t?e.is(":checked")&&(i[n]=a):i[n]=a})),n.addClass("saving"),jQuery.ajax({method:"post",url:a,data:{action:"ep_save_feature",feature:t,nonce:s.nonce,settings:i}}).done((function(e){setTimeout((function(){n.removeClass("saving"),"1"===i.active?n.addClass("feature-active"):n.removeClass("feature-active"),e.data.reindex&&(C="initialsync",b(),jQuery('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),C="sync",n.addClass("feature-syncing"),w=t,B())}),700)})).error((function(){setTimeout((function(){n.removeClass("saving"),n.removeClass("feature-active"),n.removeClass("feature-syncing")}),700)}))}})),s.index_meta?s.index_meta.wpcli_sync?(C="wpcli",j=s.index_meta.items_indexed,Q=s.index_meta.total_items,b(),k()):(j=s.index_meta.offset,Q=s.index_meta.found_items,s.index_meta.feature_sync&&(w=s.index_meta.feature_sync),s.index_meta.current_sync_item&&(e=s.index_meta.current_sync_item),s.index_meta.site_stack&&(t=s.index_meta.sync_stack),t&&t.length||0!==Q||s.index_meta.start?s.auto_start_index?(C="sync",i.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),b(),B()):(C="pause",b()):(C="finished",b())):s.auto_start_index&&(C="initialsync",b(),C="sync",i.pushState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),B()),d.on("click",(function(){C="initialsync",b(),jQuery('[data-ep-notice="no-sync"], [data-ep-notice="auto-activate-sync"], [data-ep-notice="upgrade-sync"]').remove(),C="sync",B()})),y.on("click",(function(){C="pause",b()})),u.on("click",(function(){C="sync",b(),B()})),m.on("click",(function(){C="wpcli"===C?"interrupt":"cancel",b(),E()})),v&&v.addEventListener("input",(function(e){x=e.target.value})),h.on("click",(function(e){var t=null!==e.currentTarget.getAttribute("data-epio"),n=jQuery(e.currentTarget),a=n.hasClass("initial");e.preventDefault(),a&&!v.disabled?v.value=g:v.value=x,h.removeClass("nav-tab-active"),n.addClass("nav-tab-active"),t?(f.text("ElasticPress.io Host URL"),p.text("Plug in your ElasticPress.io server here!"),_.show(),_.attr("aria-hidden","false")):(f.text("Elasticsearch Host URL"),p.text("Plug in your Elasticsearch server here!"),_.hide(),_.attr("aria-hidden","true"))}))}();