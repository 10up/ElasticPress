!function(){"use strict";var e={5251:function(e,s,n){var t=n(9196),a=60103;if(s.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var r=Symbol.for;a=r("react.element"),s.Fragment=r("react.fragment")}var i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function o(e,s,n){var t,r={},o=null,d=null;for(t in void 0!==n&&(o=""+n),void 0!==s.key&&(o=""+s.key),void 0!==s.ref&&(d=s.ref),s)c.call(s,t)&&!l.hasOwnProperty(t)&&(r[t]=s[t]);if(e&&e.defaultProps)for(t in s=e.defaultProps)void 0===r[t]&&(r[t]=s[t]);return{$$typeof:a,type:e,key:o,ref:d,props:r,_owner:i.current}}s.jsx=o,s.jsxs=o},5893:function(e,s,n){e.exports=n(5251)},9196:function(e){e.exports=window.React}},s={};function n(t){var a=s[t];if(void 0!==a)return a.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,n),r.exports}n.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(s,{a:s}),s},n.d=function(e,s){for(var t in s)n.o(s,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:s[t]})},n.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},function(){var e,s=new Uint8Array(16);function t(){if(!e&&!(e="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(s)}var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var r=function(e){return"string"===typeof e&&a.test(e)},i=[],c=0;c<256;++c)i.push((c+256).toString(16).substr(1));var l=function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(i[e[s+0]]+i[e[s+1]]+i[e[s+2]]+i[e[s+3]]+"-"+i[e[s+4]]+i[e[s+5]]+"-"+i[e[s+6]]+i[e[s+7]]+"-"+i[e[s+8]]+i[e[s+9]]+"-"+i[e[s+10]]+i[e[s+11]]+i[e[s+12]]+i[e[s+13]]+i[e[s+14]]+i[e[s+15]]).toLowerCase();if(!r(n))throw TypeError("Stringified UUID is invalid");return n};var o=function(e,s,n){var a=(e=e||{}).random||(e.rng||t)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,s){n=n||0;for(var r=0;r<16;++r)s[n+r]=a[r];return s}return l(a)},d=window.wp.element,p=window.wp.i18n;const{auto_start_index:u,ajax_url:m,index_meta:y=null,is_epio:_,ep_last_sync_date:h=null,ep_last_sync_failed:g=!1,nonce:x}=window.epDash;var w=window.wp.apiFetch,f=n.n(w);const v=e=>{let s=0;return e.current_sync_item&&(s+=e.current_sync_item.found_items),s=e.sync_stack.reduce(((e,s)=>e+s.found_items),s),s+=e.totals.failed,s+=e.totals.skipped,s+=e.totals.synced,s},S=e=>{let s=0;return e.current_sync_item&&(s+=e.current_sync_item.failed,s+=e.current_sync_item.skipped,s+=e.current_sync_item.synced),s+=e.totals.failed,s+=e.totals.skipped,s+=e.totals.synced,s};var j=window.wp.components,b=window.wp.primitives;var C=(0,d.createElement)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},(0,d.createElement)(b.Path,{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"}));var P=(0,d.createElement)(b.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},(0,d.createElement)(b.Path,{d:"M10.2 3.28c3.53 0 6.43 2.61 6.92 6h2.08l-3.5 4-3.5-4h2.32c-.45-1.97-2.21-3.45-4.32-3.45-1.45 0-2.73.71-3.54 1.78L4.95 5.66C6.23 4.2 8.11 3.28 10.2 3.28zm-.4 13.44c-3.52 0-6.43-2.61-6.92-6H.8l3.5-4c1.17 1.33 2.33 2.67 3.5 4H5.48c.45 1.97 2.21 3.45 4.32 3.45 1.45 0 2.73-.71 3.54-1.78l1.71 1.95c-1.28 1.46-3.15 2.38-5.25 2.38z"})),N=n(5893),k=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M5 16v-12h3v12h-3zM12 4h3v12h-3v-12z"})}),D=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M5 4l10 6-10 6v-12z"})}),L=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M 4 16 L 4 4 L 16 4 L 16 16 L 4 16 Z"})}),T=({disabled:e,isPaused:s,isSyncing:n,onPause:t,onResume:a,onStop:r,onSync:i,showSync:c})=>(0,N.jsxs)("div",{className:"ep-sync-controls",children:[c&&!n?(0,N.jsx)("div",{className:"ep-sync-controls__sync",children:(0,N.jsx)(j.Button,{className:"ep-sync-button ep-sync-button--sync",disabled:e,icon:P,isPrimary:!0,onClick:i,children:(0,p.__)("Sync Now","elasticpress")})}):null,n?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{className:"ep-sync-controls__pause-resume",children:s?(0,N.jsx)(j.Button,{className:"ep-sync-button ep-sync-button--resume",disabled:e,icon:D,isPrimary:!0,onClick:a,children:(0,p.__)("Resume","elasticpress")}):(0,N.jsx)(j.Button,{className:"ep-sync-button ep-sync-button--pause",disabled:e,icon:k,isPrimary:!0,onClick:t,children:(0,p.__)("Pause","elasticpress")})}),(0,N.jsx)("div",{className:"ep-sync-controls__stop",children:(0,N.jsx)(j.Button,{className:"ep-sync-button ep-sync-button--stop",icon:L,isSecondary:!0,onClick:r,children:(0,p.__)("Stop","elasticpress")})})]}):null,c?(0,N.jsx)("div",{className:"ep-sync-controls__learn-more",children:(0,N.jsx)(j.Button,{href:"https://elasticpress.zendesk.com/hc/en-us/articles/5205632443533",target:"_blank",variant:"link",children:(0,p.__)("Learn more","elasticpress")})}):null]}),I=({messages:e})=>(0,N.jsxs)("div",{className:"ep-sync-messages",children:[e.map(((e,s)=>(0,N.jsx)("div",{className:"ep-sync-messages__line-number",role:"presentation",children:s+1},`line-${e.id}`))),e.map((e=>(0,N.jsx)("div",{className:`ep-sync-messages__message ep-sync-messages__message--${e.status}`,children:e.message},`message-${e.id}`)))]}),R=({messages:e})=>{const[s,n]=(0,d.useState)(!1),t=e.filter((e=>"error"===e.status||"warning"===e.status)),a=[{messages:e,name:"full",title:(0,p.__)("Full Log","elasticpress")},{messages:t,name:"error",title:(0,p.sprintf)((0,p.__)("Errors (%d)","elasticpress"),t.length)}];return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(j.ToggleControl,{checked:s,onChange:e=>{n(e)},label:(0,p.__)("Show log","elasticpress")}),s?(0,N.jsx)(j.TabPanel,{tabs:a,children:({messages:e})=>(0,N.jsx)(I,{messages:e})}):null]})},E=window.wp.date,B=({dateTime:e,...s})=>(0,N.jsx)("time",{dateTime:(0,E.dateI18n)("c",e),...s,children:(0,E.dateI18n)("D, F d, Y H:i",e)}),F=({isComplete:e,current:s,total:n})=>{const t=Math.floor(s/n*100);return(0,N.jsx)("div",{"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":t,className:"ep-sync-progress-bar "+(e?"ep-sync-progress-bar--complete":""),role:"progressbar",children:(0,N.jsx)("div",{className:"ep-sync-progress-bar__progress",style:{minWidth:`${t}%`},children:`${t}%`})})},M=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M 7.543 17.501 L 10 15 L 10 16.25 C 11.216 16.25 12.405 15.884 13.416 15.197 C 14.427 14.509 15.213 13.531 15.679 12.389 C 16.144 11.246 16.264 9.988 16.027 8.775 C 15.788 7.561 15.201 6.448 14.34 5.573 L 16.072 3.804 C 16.875 4.615 17.512 5.582 17.946 6.645 C 18.38 7.709 18.603 8.85 18.601 10.002 C 18.601 14.834 14.751 18.75 10.002 18.75 L 10.001 18.75 L 10.001 20 L 7.543 17.501 Z M 1.399 10.001 C 1.406 5.171 5.253 1.256 10 1.25 L 10.001 1.25 L 10.001 0 L 12.458 2.501 L 10.001 5 L 10.001 3.75 L 9.999 3.75 C 8.784 3.75 7.595 4.117 6.584 4.804 C 5.574 5.493 4.786 6.469 4.321 7.612 C 3.856 8.756 3.735 10.013 3.974 11.227 C 4.211 12.439 4.798 13.552 5.659 14.427 L 3.928 16.197 C 3.126 15.39 2.489 14.429 2.055 13.369 C 1.62 12.309 1.398 11.172 1.399 10.025 L 1.399 9.999 L 1.399 10.002 L 1.399 10.001 Z"})}),O=({isCli:e,isComplete:s,isPaused:n,itemsProcessed:t,itemsTotal:a,dateTime:r})=>{const i=(0,d.useMemo)((()=>s?(0,p.__)("Sync complete","elasticpress"):n?(0,p.__)("Sync paused","elasticpress"):e?(0,p.__)("WP CLI sync in progress","elasticpress"):(0,p.__)("Sync in progress","elasticpress")),[e,s,n]);return(0,N.jsxs)("div",{className:"ep-sync-progress "+(n||s?"":"ep-sync-progress--syncing"),children:[(0,N.jsx)(j.Icon,{icon:M}),(0,N.jsxs)("div",{className:"ep-sync-progress__details",children:[(0,N.jsx)("strong",{children:i}),r?(0,N.jsxs)(N.Fragment,{children:[(0,p.__)("Started on","elasticpress")," ",(0,N.jsx)(B,{dateTime:(0,E.dateI18n)("c",r)})]}):null]}),(0,N.jsx)("div",{className:"ep-sync-progress__progress-bar",children:(0,N.jsx)(F,{current:t,isComplete:s,total:a})})]})},z=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M7.28 18c-0.15 0.020-0.26-0.020-0.41-0.070-0.56-0.19-0.83-0.79-0.66-1.35 0.17-0.55 1-3.040 1-3.58 0-0.53-0.75-1-1.35-1h-3c-0.6 0-1-0.4-1-1s2-7 2-7c0.17-0.39 0.55-1 1-1h9.14v9h-2.14c-0.41 0.41-3.3 4.71-3.58 5.27-0.21 0.41-0.6 0.68-1 0.73zM18 12h-2v-9h2v9z"})}),A=()=>(0,N.jsx)(b.SVG,{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",children:(0,N.jsx)(b.Path,{d:"M12.72 2c0.15-0.020 0.26 0.020 0.41 0.070 0.56 0.19 0.83 0.79 0.66 1.35-0.17 0.55-1 3.040-1 3.58 0 0.53 0.75 1 1.35 1h3c0.6 0 1 0.4 1 1s-2 7-2 7c-0.17 0.39-0.55 1-1 1h-9.14v-9h2.14c0.41-0.41 3.3-4.71 3.58-5.27 0.21-0.41 0.6-0.68 1-0.73zM2 8h2v9h-2v-9z"})}),V=({dateTime:e,isSuccess:s})=>(0,N.jsxs)("p",{className:"ep-sync-status "+(s?"ep-sync-status--success":"ep-sync-status--error"),children:[(0,N.jsx)(j.Icon,{icon:s?A:z}),(0,N.jsxs)("span",{className:"ep-sync-status__label",children:[s?(0,p.__)("Sync success on","elasticpress"):(0,p.__)("Sync unsuccessful on","elasticpress")," ",(0,N.jsx)(B,{dateTime:(0,E.dateI18n)("c",e),className:"ep-sync-status__time"})]})]}),W=({isCli:e,isComplete:s,isDeleting:n,isPaused:t,isSyncing:a,itemsProcessed:r,itemsTotal:i,lastSyncDateTime:c,lastSyncFailed:l,log:o,onDelete:d,onPause:u,onResume:m,onStop:y,onSync:_,syncStartDateTime:h})=>(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("h1",{className:"ep-sync-heading",children:(0,p.__)("Sync Settings","elasticpress")}),(0,N.jsx)(j.Panel,{className:"ep-sync-panel",children:(0,N.jsxs)(j.PanelBody,{className:"ep-sync-panel__body",children:[(0,N.jsxs)("div",{className:"ep-sync-panel__description",children:[(0,N.jsx)("p",{className:"ep-sync-panel__introduction",children:(0,p.__)("If you are missing data in your search results or have recently added custom content types to your site, you should run a sync to reflect these changes.","elasticpress")}),c?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("h3",{className:"ep-sync-heading",children:(0,p.__)("Last Sync","elasticpress")}),(0,N.jsx)(V,{dateTime:c,isSuccess:!l})]}):null]}),(0,N.jsx)("div",{className:"ep-sync-panel__controls",children:(0,N.jsx)(T,{disabled:a&&n||a&&e,isPaused:t,isSyncing:a&&!n,onPause:u,onResume:m,onStop:y,onSync:_,showSync:!0})}),n||!a&&!s?null:(0,N.jsx)("div",{className:"ep-sync-panel__row",children:(0,N.jsx)(O,{dateTime:h,isCli:e,isComplete:s,isPaused:t,itemsProcessed:r,itemsTotal:i})}),(0,N.jsx)("div",{className:"ep-sync-panel__row",children:(0,N.jsx)(R,{messages:o.filter((e=>!e.isDeleting))})})]})}),(0,N.jsx)("h2",{className:"ep-sync-heading",children:(0,p.__)("Delete All Data and Sync","elasticpress")}),(0,N.jsx)(j.Panel,{className:"ep-sync-panel",children:(0,N.jsxs)(j.PanelBody,{className:"ep-sync-panel__body",children:[(0,N.jsxs)("div",{className:"ep-sync-panel__description",children:[(0,N.jsx)("p",{className:"ep-sync-panel__introduction",children:(0,p.__)("If you are still having issues with your search results, you may need to do a completely fresh sync.","elasticpress")}),(0,N.jsx)("p",{children:(0,N.jsx)(j.Button,{className:"ep-sync-button ep-sync-button--delete",disabled:a,isSecondary:!0,isDestructive:!0,onClick:d,children:(0,p.__)("Delete all Data and Start a Fresh Sync","elasticpress")})})]}),(0,N.jsx)("div",{className:"ep-sync-panel__controls",children:(0,N.jsx)(T,{disabled:a&&!n||a&&e,isPaused:t,isSyncing:a&&n,onPause:u,onResume:m,onStop:y})}),n&&(a||s)?(0,N.jsx)("div",{className:"ep-sync-panel__row",children:(0,N.jsx)(O,{dateTime:h,isCli:e,isComplete:s,isPaused:t,itemsProcessed:r,itemsTotal:i})}):null,(0,N.jsx)("div",{className:"ep-sync-panel__row",children:(0,N.jsx)(R,{messages:o.filter((e=>e.isDeleting))})}),(0,N.jsx)("div",{className:"ep-sync-panel__row",children:(0,N.jsxs)("p",{className:"ep-sync-warning",children:[(0,N.jsx)(j.Icon,{icon:C}),(0,p.__)("All indexed data on ElasticPress will be deleted without affecting anything on your WordPress website. This may take a few hours depending on the amount of content that needs to be synced and indexed. While this is happening, searches will use the default WordPress results","elasticpress")]})})]})})]});const G=()=>{const{cancelIndex:e,index:s,indexStatus:n}=(()=>{const e=(0,d.useRef)(new AbortController),s=(0,d.useRef)(null),n=(0,d.useCallback)((e=>(s.current=f()(e).finally((()=>{s.current=null})),s.current)),[]);return{cancelIndex:(0,d.useCallback)((async()=>{e.current.abort(),e.current=new AbortController;const s=new FormData;s.append("action","ep_cancel_index"),s.append("nonce",x);const t={url:m,method:"POST",body:s,signal:e.current.signal};return n(t)}),[n]),index:(0,d.useCallback)((async s=>{e.current.abort(),e.current=new AbortController;const t=new FormData;t.append("action","ep_index"),t.append("put_mapping",s?1:0),t.append("nonce",x);const a={url:m,method:"POST",body:t,signal:e.current.signal};return n(a)}),[n]),indexStatus:(0,d.useCallback)((async()=>{e.current.abort(),e.current=new AbortController;const s=new FormData;s.append("action","ep_index_status"),s.append("nonce",x);const t={url:m,method:"POST",body:s,signal:e.current.signal};return n(t)}),[n])}})(),[t,a]=(0,d.useState)([]),[r,i]=(0,d.useState)({isComplete:!1,isDeleting:!1,isSyncing:!1,itemsProcessed:0,itemsTotal:100,lastSyncDateTime:h,lastSyncFailed:g,syncStartDateTime:null}),c=(0,d.useRef)(r),l=e=>{c.current={...c.current,...e},i((s=>({...s,...e})))},w=(0,d.useCallback)(((e,s)=>{const{isDeleting:n}=c.current,t=Array.isArray(e)?e:[e];for(const e of t)a((t=>[...t,{message:e,status:s,isDeleting:n,id:o()}]))}),[]),j=(0,d.useCallback)((e=>{l({isComplete:!0,isPaused:!1,isSyncing:!1,lastSyncDateTime:e.end_date_time,lastSyncFailed:e.failed>0})}),[]),b=(0,d.useCallback)((e=>{"AbortError"!==e.name&&(e.message&&w(e.message,"error"),w((0,p.__)("Sync failed","elasticpress"),"error"),l({isSyncing:!1}))}),[w]),C=(0,d.useCallback)((()=>{const{isDeleting:e}=c.current,s=e?(0,p.sprintf)((0,p.__)("Your indexing process has been stopped by WP-CLI and your %s index could be missing content. To restart indexing, please click the Start button or use WP-CLI commands to perform the reindex. Please note that search results could be incorrect or incomplete until the reindex finishes.","elasticpress"),_?(0,p.__)("ElasticPress.io","elasticpress"):(0,p.__)("Elasticsearch","elasticpress")):(0,p.__)("Sync interrupted by WP-CLI command.","elasticpress");w(s,"info"),l({isSyncing:!1})}),[w]),P=(0,d.useCallback)((e=>{l({isCli:"cli"===e.method,isComplete:!1,isDeleting:e.put_mapping,isSyncing:!0,itemsProcessed:S(e),itemsTotal:v(e),syncStartDateTime:e.start_date_time})}),[]),k=(0,d.useCallback)((e=>{const{isPaused:s,isSyncing:n}=c.current,{message:t,status:a,totals:r=[],index_meta:i}=e.data;return new Promise((e=>{n&&(t&&w(t,a),Array.isArray(r)?(P(i),i.should_interrupt_sync?C():s?w((0,p.__)("Sync paused","elasticpress"),"info"):e(i.method)):j(r))}))}),[j,P,C,w]),D=(0,d.useCallback)((()=>{n().then(k).then(D).catch(b)}),[n,b,k]),L=(0,d.useCallback)((e=>{s(e).then(k).then((s=>{"cli"===s?D():L(e)})).catch(b)}),[D,s,b,k]),T=(0,d.useCallback)((()=>{l({isComplete:!1,isPaused:!0,isSyncing:!0})}),[]),I=(0,d.useCallback)((()=>{l({isComplete:!1,isPaused:!1,isSyncing:!1}),e()}),[e]),R=(0,d.useCallback)((()=>{l({isComplete:!1,isPaused:!1,isSyncing:!0}),L(c.current.isDeleting)}),[L]),E=(0,d.useCallback)((e=>{l({isComplete:!1,isDeleting:e,isPaused:!1,isSyncing:!0}),l({itemsProcessed:0,syncStartDateTime:Date.now()}),L(e)}),[L]);return(0,d.useEffect)((()=>{if(window.history.replaceState({},document.title,document.location.pathname+document.location.search.replace(/&do_sync/,"")),y)return P(y),void("cli"===y.method?(D(),w((0,p.__)("WP CLI sync in progress","elasticpress"),"info")):(T(),w((0,p.__)("Sync paused","elasticpress"),"info")));u&&(E(!0),w((0,p.__)("Starting delete and sync…","elasticpress"),"info"))}),[D,P,w,T,E]),(0,N.jsx)(W,{log:t,onDelete:async()=>{E(!0),w((0,p.__)("Starting delete and sync…","elasticpress"),"info")},onPause:()=>{T(),w((0,p.__)("Pausing sync…","elasticpress"),"info")},onResume:()=>{R(),w((0,p.__)("Resuming sync…","elasticpress"),"info")},onStop:()=>{I(),w((0,p.__)("Sync stopped","elasticpress"),"info")},onSync:async()=>{E(!1),w((0,p.__)("Starting sync…","elasticpress"),"info")},...r})};(0,d.render)((0,N.jsx)(G,{}),document.getElementById("ep-sync"))}()}();